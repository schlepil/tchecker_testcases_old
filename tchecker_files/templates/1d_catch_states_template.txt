# Translation of 1d catch to tchecker
# In this template each (sub)-funnel will get its own discrete state (Not just a discrete variable)

# The catching events have to be generated by python

system:LIN_Catch

# The clocks
clock:1:glob
clock:1:ctrl
clock:1:local

# The events
event:noaction
event:start
event:catch
event:deliver

# Necessary variables
# Number of currently carried items
int:1:0:__maxCarry__:0:carried
# Number of packages to be returned : __nbrPack__
# Number of already delivered packages
int:1:0:__nbrPack__:0:delivered

# Necessary processes
# Synchronizer for start
process:starter
# Process for the "conveyor belt"
process:belt
# The system/robot catching the packages
process:rob

# synchronisations
# all go
sync:starter@start:belt@start:rob@start
# catching
sync:belt@catch:rob@catch
# delivering
sync:belt@catch:rob@catch


# Define the starter
# Two locations
location:starter:waiting{initial::committed:}
location:starter:running{}
# Start
edge:starter:waiting:running:start{do:glob=0}

# Define the belt
# Initial - waiting for starter
location:belt:waiting{initial:}
# package not yet in position
location:belt:approach{committed:}
# Package ready to be to be caught
location:belt:arrived{committed:}
# All packages are successfully delivered
location:belt:success{labels:alldelivered}

# The transitions - Base
# The events catch and deliver have to reappear in rob
# Catching -> Increment carried
edge:belt:arrived:approach:catch{do:carried=carried+1}
# Delivering -> Increase delivered by carried
edge:belt:approach:approach:deliver{provided:carried>0:do:delivered=delivered+carried; carried=0}
# Success transition
edge:belt:approach:success:noaction
# The transitions when a package arrives have to be set by python
# Belt Arriving Transitions
__BeltArrivingTrans__


# Define the robot/system
# Locations base
location:rob:waiting{initial::committed:}
# Robot funnel states
__RobFunnelStates__

# The transitions
# The starting transition transitions to the initial funnel __initFunnel__
edge:rob:waiting:__initFunnel__:start{do:ctrl=__initCtrlClock__;local=__initLocalClock__}
# the transitions between the funnels
__RobFunnelTrans__









